'use client';

import React, { useState, useEffect, FormEvent, FC } from 'react';
import { useRouter } from 'next/navigation';
import {
  BarChart,
  Bar,
  PieChart,
  Pie,
  Cell,
  LineChart,
  Line,
  AreaChart,
  Area,
  RadarChart,
  Radar,
  PolarGrid,
  PolarAngleAxis,
  PolarRadiusAxis,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from 'recharts';

const EmailGate: FC<{ onSuccess: () => void }> = ({ onSuccess }) => {
  const [email, setEmail] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    if (!email || !/\S+@\S+\.\S+/.test(email)) {
      setError('Please enter a valid email address.');
      setLoading(false);
      return;
    }

    try {
      const res = await fetch('/api/subscribe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email }),
      });

      if (res.ok) {
        localStorage.setItem('kael_email', email);
        onSuccess();
      } else {
        const data = await res.json();
        setError(data.message || 'An error occurred. Please try again.');
      }
    } catch (err) {
      setError('An error occurred. Please try again.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center text-white p-4">
      <div className="w-full max-w-md text-center">
        <h1 className="text-2xl font-bold mb-2">
          <span className="text-white">KAEL</span>
          <span className="text-amber-400">RESEARCH</span>
        </h1>
        <h2 className="text-3xl md:text-4xl font-bold tracking-tight text-slate-100 mb-4">Unlock Premium Market Insights</h2>
        <p className="text-slate-400 mb-8">Enter your email to access our exclusive sample report on the AI Code Assistant Market.</p>

        <form onSubmit={handleSubmit} className="flex flex-col gap-4">
          <input
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="your.email@company.com"
            className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-md focus:ring-2 focus:ring-amber-500 focus:outline-none transition-shadow"
            required
            disabled={loading}
          />
          <button
            type="submit"
            disabled={loading}
            className="w-full bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold py-3 px-4 rounded-md transition-colors disabled:bg-slate-700 disabled:cursor-not-allowed"
          >
            {loading ? 'Unlocking...' : 'Access Report'}
          </button>
        </form>
        {error && <p className="text-red-400 mt-4">{error}</p>}
        <p className="text-xs text-slate-500 mt-6">We respect your privacy. No spam.</p>
      </div>
    </div>
  );
};

const ReportHeader: FC = () => {
  const router = useRouter();
  return (
    <header className="fixed top-0 left-0 right-0 z-50 bg-slate-950/80 backdrop-blur-lg border-b border-slate-800">
      <nav className="container mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex items-center justify-between h-16">
          <div className="flex-shrink-0">
            <a href="/" className="text-xl font-bold">
              <span className="text-white">KAEL</span>
              <span className="text-amber-400">RESEARCH</span>
            </a>
          </div>
          <div className="flex items-center gap-2 sm:gap-4">
            <a
              href="/api/pdf"
              className="px-3 py-2 rounded-md text-sm font-medium text-slate-300 hover:text-white hover:bg-slate-800 transition-colors"
            >
              Download PDF
            </a>
            <button
              onClick={() => router.push('/#pricing')}
              className="bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold py-2 px-4 rounded-md text-sm transition-colors"
            >
              Order a Report
            </button>
          </div>
        </div>
      </nav>
    </header>
  );
};

const ReportFooter: FC = () => (
  <footer className="bg-slate-950 border-t border-slate-800 mt-16 sm:mt-24">
    <div className="container mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center text-slate-400">
      <p className="text-lg font-bold">
        <span className="text-white">KAEL</span>
        <span className="text-amber-400">RESEARCH</span>
      </p>
      <p className="mt-2 text-sm">Copyright &copy; 2026. All rights reserved.</p>
      <a href="mailto:contact@kaelresearch.com" className="mt-2 text-sm hover:text-amber-400 transition-colors">
        contact@kaelresearch.com
      </a>
    </div>
  </footer>
);

const ChartWrapper: FC<{ children: React.ReactNode }> = ({ children }) => {
  const [mounted, setMounted] = useState(false);
  useEffect(() => setMounted(true), []);
  return <div className="w-full h-80 sm:h-96">{mounted && children}</div>;
};

type Status = 'strong' | 'partial' | 'no';
const StatusIcon: FC<{ status: Status }> = ({ status }) => {
  const statusMap: Record<Status, { color: string; label: string }> = {
    strong: { color: 'bg-green-500', label: 'Strong' },
    partial: { color: 'bg-amber-500', label: 'Partial' },
    no: { color: 'bg-red-500', label: 'No' },
  };
  const { color, label } = statusMap[status];

  return (
    <div className="flex items-center justify-center">
       <div className={`h-3 w-3 rounded-full ${color}`} title={label}></div>
       <span className="sr-only">{label}</span>
    </div>
  );
};

const ReportPage: FC = () => {
    const marketSizingData = [
      { name: '2023', TAM: 8.2, SAM: 3.1, SOM: 1.1 },
      { name: '2024', TAM: 12.5, SAM: 5.4, SOM: 2.1 },
      { name: '2025', TAM: 18.1, SAM: 8.7, SOM: 5.8 },
      { name: '2026P', TAM: 24.0, SAM: 13.2, SOM: 9.4 },
    ];
    
    const marketShareData = [
      { name: 'GitHub Copilot', value: 42, revenue: 2.44, yoy: '+68%', color: '#f59e0b' },
      { name: 'Cursor', value: 10, revenue: 0.58, yoy: '+340%', color: '#3b82f6' },
      { name: 'Windsurf', value: 7, revenue: 0.41, yoy: '+185%', color: '#10b981' },
      { name: 'Amazon Q', value: 6, revenue: 0.35, yoy: '+42%', color: '#8b5cf6' },
      { name: 'Tabnine', value: 4, revenue: 0.23, yoy: '+15%', color: '#ef4444' },
      { name: 'JetBrains AI', value: 3.5, revenue: 0.20, yoy: '+120%', color: '#ec4899' },
      { name: 'Others', value: 27.5, revenue: 1.42, yoy: 'N/A', color: '#475569' },
    ];

    const copilotDeclineData = [
      { name: 'Q1 24', value: 55 }, { name: 'Q2 24', value: 52 }, { name: 'Q3 24', value: 49 },
      { name: 'Q4 24', value: 46 }, { name: 'Q1 25', value: 44 }, { name: 'Q2 25', value: 43 },
      { name: 'Q3 25', value: 42.5 }, { name: 'Q4 25', value: 42 },
    ];

    const featureRadarData = [
        { subject: 'Autocomplete', Copilot: 90, Cursor: 92, Windsurf: 88, fullMark: 100 },
        { subject: 'Multi-file Edit', Copilot: 75, Cursor: 95, Windsurf: 85, fullMark: 100 },
        { subject: 'Codebase Aware', Copilot: 60, Cursor: 95, Windsurf: 80, fullMark: 100 },
        { subject: 'Agentic Tasks', Copilot: 70, Cursor: 90, Windsurf: 85, fullMark: 100 },
        { subject: 'Enterprise', Copilot: 95, Cursor: 70, Windsurf: 75, fullMark: 100 },
        { subject: 'Ecosystem', Copilot: 95, Cursor: 65, Windsurf: 60, fullMark: 100 },
    ];

    const adoptionTrendsData = [
      { name: '2023', tried: 44, daily: 27, 'cant-live-without': 15, resist: 31 },
      { name: '2024', tried: 62, daily: 41, 'cant-live-without': 24, resist: 24 },
      { name: '2025', tried: 76, daily: 52, 'cant-live-without': 34, resist: 18 },
    ];
    
    const npsData = [
        { name: 'Cursor', score: 62, color: '#4ade80' },
        { name: 'Windsurf', score: 45, color: '#4ade80' },
        { name: 'Copilot', score: 38, color: '#facc15' },
        { name: 'Amazon Q', score: 12, color: '#facc15' },
        { name: 'Tabnine', score: 8, color: '#f87171' },
    ];

    const featureMatrixData = {
        features: ['Inline Autocomplete', 'Multi-file Editing', 'Codebase Awareness', 'Agentic Execution', 'Custom Model Support', 'On-premise'],
        competitors: {
            'Copilot': ['strong', 'strong', 'partial', 'strong', 'no', 'strong'] as Status[],
            'Cursor': ['strong', 'strong', 'strong', 'strong', 'strong', 'no'] as Status[],
            'Windsurf': ['strong', 'strong', 'strong', 'strong', 'partial', 'strong'] as Status[],
            'Amazon Q': ['partial', 'partial', 'partial', 'partial', 'no', 'strong'] as Status[],
            'Tabnine': ['strong', 'no', 'partial', 'no', 'strong', 'strong'] as Status[],
        }
    };
    
    const Section: FC<{ title: string; children: React.ReactNode, className?: string }> = ({ title, children, className }) => (
      <section className={`py-12 sm:py-16 border-b border-slate-800 ${className}`}>
        <h2 className="text-3xl font-bold tracking-tight text-white mb-8">{title}</h2>
        {children}
      </section>
    );

    const StatCard: FC<{ label: string; value: string | number }> = ({ label, value }) => (
        <div className="bg-slate-900 p-6 rounded-lg border border-slate-800 text-center">
            <p className="text-sm text-slate-400">{label}</p>
            <p className="text-2xl sm:text-3xl font-bold text-amber-400 mt-1">{value}</p>
        </div>
    );
    
    const CustomTooltip = ({ active, payload, label }: any) => {
        if (active && payload && payload.length) {
            return (
            <div className="p-4 bg-slate-800 border border-slate-700 rounded-md shadow-lg text-sm">
                <p className="label font-bold text-white">{`${label}`}</p>
                {payload.map((pld: any) => (
                    <div key={pld.dataKey} style={{ color: pld.color }}>
                        {`${pld.name}: ${pld.value.toLocaleString()}`}
                    </div>
                ))}
            </div>
            );
        }
        return null;
    };

  return (
    <div className="bg-slate-950 text-slate-300 font-sans">
      <ReportHeader />
      <main className="container mx-auto px-4 sm:px-6 lg:px-8 pt-24">
        {/* Title Section */}
        <div className="text-center py-12 border-b border-slate-800">
          <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight text-white">
            The AI Code Assistant Market
          </h1>
          <h2 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight text-amber-400">
            2026 Landscape Analysis
          </h2>
          <p className="mt-6 text-lg text-slate-400">Prepared by Kael Research ΓÇö February 2026</p>
          <div className="mt-8 flex justify-center gap-4 sm:gap-8 text-slate-300">
            <div className="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-amber-400" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M4 2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4zm10.5 5.5a.5.5 0 000-1H10V5.5a.5.5 0 00-1 0V7H8.5a.5.5 0 000 1H9v1.5a.5.5 0 001 0V8h1.5a.5.5 0 000-1H10V7h.5a.5.5 0 01.5.5c0 .25-.25.5-.5.5H10v.5a.5.5 0 001 0V8h.5a.5.5 0 00.5-.5H12v-.5a.5.5 0 01.5-.5h.5a.5.5 0 000-1h-.5A1.5 1.5 0 0012 5.5v.5h-.5a1.5 1.5 0 00-1.5 1.5v.5h.5a.5.5 0 010 1H10v.5A1.5 1.5 0 0011.5 11h.5a.5.5 0 000-1h-.5a.5.5 0 01-.5-.5V9h.5a.5.5 0 00.5-.5H12V8h.5a.5.5 0 00.5-.5zM6 6.5A1.5 1.5 0 017.5 5h.5a.5.5 0 000-1h-.5A2.5 2.5 0 005 6.5v7A2.5 2.5 0 007.5 16h5A2.5 2.5 0 0015 13.5v-7a.5.5 0 00-1 0v7a1.5 1.5 0 01-1.5 1.5h-5A1.5 1.5 0 016 13.5v-7z" clipRule="evenodd" /></svg>
                <span>47 Pages</span>
            </div>
            <div className="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-amber-400" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fillRule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clipRule="evenodd" /></svg>
                <span>86 Sources</span>
            </div>
            <div className="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-amber-400" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm0 2h10v2H5V5zm0 4h10v2H5V9zm0 4h10v2H5v-2z" clipRule="evenodd" /></svg>
                <span>12 Data Tables</span>
            </div>
          </div>
        </div>

        {/* Executive Summary */}
        <Section title="Executive Summary" className="prose prose-invert max-w-none prose-p:text-slate-300 prose-li:text-slate-300 prose-headings:text-white">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <StatCard label="Market Size (2025)" value="$5.8B" />
                <StatCard label="Projected (2026)" value="$9.4B" />
                <StatCard label="Enterprise Adoption" value="71%" />
            </div>
            <ul className="space-y-4 text-lg">
                <li><strong className="text-amber-400">Market Growth:</strong> $2.1B (2024) ΓåÆ $5.8B (2025) ΓåÆ $9.4B projected (2026), driven by enterprise adoption and productivity gains.</li>
                <li><strong className="text-amber-400">GitHub Copilot:</strong> 42% market share, down from 55% in early 2024 as competition intensifies.</li>
                <li><strong className="text-amber-400">Cursor:</strong> Breakout story with 3.2M users, ~$200M ARR, and +340% YoY growth, signaling demand for integrated, codebase-aware tools.</li>
                <li><strong className="text-amber-400">Strategic Shift:</strong> The market is rapidly moving beyond simple "assistants" to more powerful agentic coding workflows.</li>
                <li><strong className="text-amber-400">Pricing Power:</strong> Free tiers haven't collapsed the market; developers and businesses are willing to pay $20-40/month for premium features.</li>
                <li><strong className="text-amber-400">M&A Activity:</strong> Expect 2-3 significant acquisitions by major cloud or platform players by the end of 2027.</li>
            </ul>
        </Section>
        
        {/* Market Sizing */}
        <Section title="Market Sizing">
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12">
                <div className="lg:col-span-2">
                    <h3 className="text-xl font-bold text-white mb-4">Market Potential (TAM, SAM, SOM) in $USD Billions</h3>
                    <ChartWrapper>
                        <ResponsiveContainer width="100%" height="100%">
                        <BarChart data={marketSizingData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                            <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                            <XAxis dataKey="name" stroke="#94a3b8" />
                            <YAxis stroke="#94a3b8" unit="B" tickFormatter={(v) => `$${v}`}/>
                            <Tooltip content={<CustomTooltip />} cursor={{ fill: '#1e293b' }} />
                            <Legend />
                            <Bar dataKey="TAM" fill="#8884d8" name="Total Addressable Market" />
                            <Bar dataKey="SAM" fill="#82ca9d" name="Serviceable Addressable Market" />
                            <Bar dataKey="SOM" fill="#f59e0b" name="Serviceable Obtainable Market" />
                        </BarChart>
                        </ResponsiveContainer>
                    </ChartWrapper>
                </div>
                <div className="prose prose-invert max-w-none prose-p:text-slate-300">
                    <h3 className="text-xl font-bold text-white">Key Factors</h3>
                    <h4 className="font-bold text-green-400 mt-4">Growth Drivers</h4>
                    <ul>
                        <li><strong className="text-white">Scale:</strong> 32 Million developers worldwide presents a massive user base.</li>
                        <li><strong className="text-white">Productivity:</strong> Reported gains of 27-55% are too significant for enterprises to ignore.</li>
                        <li><strong className="text-white">Agentic Shift:</strong> Move to autonomous agents creates new, higher-value use cases.</li>
                    </ul>
                    <h4 className="font-bold text-red-400 mt-6">Growth Constraints</h4>
                    <ul>
                        <li><strong className="text-white">Security (34%):</strong> Concerns about code/IP leakage remain a primary barrier.</li>
                        <li><strong className="text-white">Quality Plateau:</strong> Perceived leveling-off of core model quality.</li>
                        <li><strong className="text-white">Resistance (18%):</strong> A segment of developers remains skeptical or resistant to adoption.</li>
                    </ul>
                </div>
            </div>
        </Section>

        {/* Competitive Landscape */}
        <Section title="Competitive Landscape">
             <div className="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div>
                    <h3 className="text-xl font-bold text-white mb-4 text-center">Market Share by Revenue (2025)</h3>
                     <ChartWrapper>
                         <ResponsiveContainer width="100%" height="100%">
                            <PieChart>
                                <Pie data={marketShareData} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={'80%'} labelLine={false}
                                     label={({ cx, cy, midAngle, innerRadius, outerRadius, percent, index }) => {
                                        const RADIAN = Math.PI / 180;
                                        const radius = innerRadius + (outerRadius - innerRadius) * 1.2;
                                        const x = cx + radius * Math.cos(-midAngle * RADIAN);
                                        const y = cy + radius * Math.sin(-midAngle * RADIAN);
                                        const data = marketShareData[index];
                                        return (
                                            <text x={x} y={y} fill={data.color} textAnchor={x > cx ? 'start' : 'end'} dominantBaseline="central" fontSize={12}>
                                                {`${data.name} (${(percent * 100).toFixed(1)}%)`}
                                            </text>
                                        );
                                     }}
                                >
                                    {marketShareData.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} />)}
                                </Pie>
                                <Tooltip formatter={(v, name, props) => [`$${props.payload.revenue}B (${v}%)`, props.payload.name]} />
                            </PieChart>
                         </ResponsiveContainer>
                    </ChartWrapper>
                </div>
                <div>
                    <h3 className="text-xl font-bold text-white mb-4 text-center">GitHub Copilot Market Share Decline</h3>
                    <ChartWrapper>
                        <ResponsiveContainer width="100%" height="100%">
                            <AreaChart data={copilotDeclineData} margin={{ top: 10, right: 30, left: 0, bottom: 0 }}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                                <XAxis dataKey="name" stroke="#94a3b8" />
                                <YAxis stroke="#94a3b8" domain={[40, 60]} unit="%" />
                                <Tooltip content={<CustomTooltip />} />
                                <Area type="monotone" dataKey="value" name="Market Share" stroke="#f59e0b" fill="#f59e0b" fillOpacity={0.2} />
                            </AreaChart>
                        </ResponsiveContainer>
                    </ChartWrapper>
                </div>
            </div>
        </Section>

        {/* Feature Comparison */}
        <Section title="Feature Comparison">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                 <div>
                    <h3 className="text-xl font-bold text-white mb-4 text-center">Core Capabilities Score (0-100)</h3>
                    <ChartWrapper>
                        <ResponsiveContainer width="100%" height="100%">
                            <RadarChart cx="50%" cy="50%" outerRadius="80%" data={featureRadarData}>
                                <PolarGrid stroke="#475569" />
                                <PolarAngleAxis dataKey="subject" stroke="#cbd5e1" tick={{ fontSize: 12 }} />
                                <PolarRadiusAxis angle={30} domain={[0, 100]} stroke="#475569" />
                                <Radar name="Copilot" dataKey="Copilot" stroke="#f59e0b" fill="#f59e0b" fillOpacity={0.5} />
                                <Radar name="Cursor" dataKey="Cursor" stroke="#3b82f6" fill="#3b82f6" fillOpacity={0.5} />
                                <Radar name="Windsurf" dataKey="Windsurf" stroke="#10b981" fill="#10b981" fillOpacity={0.5} />
                                <Tooltip content={<CustomTooltip />} />
                                <Legend />
                            </RadarChart>
                        </ResponsiveContainer>
                    </ChartWrapper>
                 </div>
                 <div>
                    <h3 className="text-xl font-bold text-white mb-6 text-center">Feature Matrix</h3>
                    <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr>
                                    <th className="p-3 bg-slate-900 border-b border-slate-700 text-sm font-bold text-white">Feature</th>
                                    {Object.keys(featureMatrixData.competitors).map(c => <th key={c} className="p-3 bg-slate-900 border-b border-slate-700 text-sm font-bold text-white text-center">{c}</th>)}
                                </tr>
                            </thead>
                            <tbody>
                                {featureMatrixData.features.map((feature, idx) => (
                                    <tr key={feature} className="bg-slate-950 hover:bg-slate-900">
                                        <td className="p-3 border-b border-slate-800 text-sm text-slate-300 font-medium">{feature}</td>
                                        {Object.values(featureMatrixData.competitors).map((statuses, cIdx) => (
                                            <td key={cIdx} className="p-3 border-b border-slate-800 text-center"><StatusIcon status={statuses[idx]} /></td>
                                        ))}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>
        </Section>
        
        {/* Pricing */}
        <Section title="Pricing">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 className="text-xl font-bold text-white mb-4">Individual Tiers</h3>
                    <div className="space-y-3">
                        {Object.entries({ Copilot: 10, Cursor: 20, Windsurf: 15, 'Amazon Q': 19, Tabnine: 12 }).map(([name, price]) => (
                             <div key={name} className="flex justify-between items-center bg-slate-900 p-4 rounded-md border border-slate-800">
                                <span className="font-medium text-slate-200">{name}</span>
                                <span className="font-bold text-amber-400">${price}<span className="text-sm font-normal text-slate-400">/mo</span></span>
                            </div>
                        ))}
                    </div>
                </div>
                <div>
                     <h3 className="text-xl font-bold text-white mb-4">Enterprise Tiers</h3>
                     <div className="space-y-3">
                        {Object.entries({ 'Copilot Enterprise': 39, 'Copilot Business': 19, 'Cursor Business': 40, 'Windsurf Enterprise': '30-45' }).map(([name, price]) => (
                             <div key={name} className="flex justify-between items-center bg-slate-900 p-4 rounded-md border border-slate-800">
                                <span className="font-medium text-slate-200">{name}</span>
                                <span className="font-bold text-amber-400">{typeof price === 'number' ? `$${price}`: `$${price}`}<span className="text-sm font-normal text-slate-400">/u/mo</span></span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        </Section>

        {/* Adoption Trends */}
        <Section title="Adoption Trends">
            <div className="grid grid-cols-1 lg:grid-cols-5 gap-12">
                <div className="lg:col-span-3">
                    <h3 className="text-xl font-bold text-white mb-4">Developer Sentiment Over Time</h3>
                    <ChartWrapper>
                        <ResponsiveContainer width="100%" height="100%">
                             <LineChart data={adoptionTrendsData} margin={{ top: 5, right: 30, left: 0, bottom: 5 }}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                                <XAxis dataKey="name" stroke="#94a3b8" />
                                <YAxis stroke="#94a3b8" unit="%" />
                                <Tooltip content={<CustomTooltip />} />
                                <Legend />
                                <Line type="monotone" dataKey="tried" name="Tried" stroke="#8884d8" />
                                <Line type="monotone" dataKey="daily" name="Daily User" stroke="#82ca9d" />
                                <Line type="monotone" dataKey="cant-live-without" name="Can't Live Without" stroke="#f59e0b" />
                                <Line type="monotone" dataKey="resist" name="Resist Adoption" stroke="#ef4444" />
                            </LineChart>
                        </ResponsiveContainer>
                    </ChartWrapper>
                </div>
                 <div className="lg:col-span-2">
                    <h3 className="text-xl font-bold text-white mb-4">Net Promoter Score (NPS)</h3>
                    <ChartWrapper>
                       <ResponsiveContainer width="100%" height="100%">
                         <BarChart layout="vertical" data={npsData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                           <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                           <XAxis type="number" stroke="#94a3b8" domain={[0, 70]} />
                           <YAxis dataKey="name" type="category" stroke="#94a3b8" width={80} />
                           <Tooltip cursor={{ fill: '#1e293b' }} formatter={(v) => [`+${v}`, 'NPS']} />
                           <Bar dataKey="score" name="NPS">
                            {npsData.map((entry, index) => (
                                <Cell key={`cell-${index}`} fill={entry.color} />
                            ))}
                           </Bar>
                         </BarChart>
                       </ResponsiveContainer>
                    </ChartWrapper>
                </div>
            </div>
            <div className="mt-16">
                 <h3 className="text-xl font-bold text-white mb-6 text-center">Adoption by Company Size</h3>
                 <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 sm:gap-6">
                    {[{size: '1-10', pct: '68%', primary: 'Cursor (34%)', seats: 4}, {size: '11-100', pct: '74%', primary: 'Copilot (41%)', seats: 28}, {size: '101-500', pct: '71%', primary: 'Copilot (48%)', seats: 95}, {size: '501-5K', pct: '78%', primary: 'Copilot (52%)', seats: 420}, {size: '5000+', pct: '65%', primary: 'Copilot (58%)', seats: 2100}].map(item =>(
                        <div key={item.size} className="bg-slate-900 p-4 rounded-lg border border-slate-800 text-center">
                            <p className="font-bold text-slate-200">{item.size} <span className="text-xs text-slate-400">emp.</span></p>
                            <p className="text-3xl font-bold text-amber-400 my-2">{item.pct}</p>
                            <p className="text-xs text-slate-400">Primary: {item.primary}</p>
                            <p className="text-xs text-slate-400">Avg Seats: {item.seats}</p>
                        </div>
                    ))}
                 </div>
            </div>
        </Section>

        {/* Recommendations & Methodology */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-x-16">
            <Section title="Strategic Recommendations" className="border-b-0 lg:border-b-0">
                <ol className="list-decimal list-outside space-y-6 pl-5 text-lg marker:text-amber-400 marker:font-bold">
                    <li><span className="font-semibold text-white">Target a Niche.</span> The general-purpose assistant market is saturating. Focus on specific domains like security, data science, or legacy codebases.</li>
                    <li><span className="font-semibold text-white">Bet on Agents, Not Autocomplete.</span> Autocomplete is becoming a commodity. The next frontier is agentic workflows that execute complex multi-step tasks.</li>
                    <li><span className="font-semibold text-white">Dual-Tier Strategy.</span> Enterprise sales provide revenue, but a strong developer-focused free or individual tier is essential for distribution and mindshare.</li>
                    <li><span className="font-semibold text-white">Solve for Trust First.</span> SOC 2 Type II compliance, on-premise options, and transparent data handling are non-negotiable for enterprise adoption.</li>
                    <li><span className="font-semibold text-white">Build for a Model-Agnostic Future.</span> The best underlying model will constantly change. Abstract this away and build infrastructure for automatic model routing and fine-tuning.</li>
                </ol>
            </Section>
            <Section title="Methodology" className="border-b-0">
                 <ul className="list-disc list-outside space-y-4 pl-5 text-lg">
                    <li>Combination of primary and secondary research, including reports from Gartner, IDC, and Forrester, plus developer surveys from Stack Overflow and JetBrains.</li>
                    <li>34 structured interviews conducted with engineering leaders and senior developers from October 2025 to January 2026.</li>
                    <li>Bottom-up market sizing model based on developer population, adoption rates, and pricing tiers.</li>
                    <li>Hands-on, in-depth product testing of all major platforms covered in the report.</li>
                    <li>This research was conducted independently by Kael Research and was not sponsored by any of the companies mentioned.</li>
                </ul>
            </Section>
        </div>
        
        {/* CTA */}
        <div className="text-center py-16 sm:py-24 border-t border-slate-800 mt-12">
            <h2 className="text-3xl sm:text-4xl font-bold tracking-tight text-white">Need This Level of Analysis for Your Market?</h2>
            <p className="mt-4 max-w-2xl mx-auto text-lg text-slate-400">Our bespoke research reports give you the strategic advantage to lead, innovate, and capture market share.</p>
            <div className="mt-8 flex justify-center gap-4">
                <a href="/#pricing" className="bg-amber-500 hover:bg-amber-600 text-slate-950 font-bold py-3 px-6 rounded-md text-base transition-colors">
                    View Pricing
                </a>
                <a href="mailto:contact@kaelresearch.com" className="bg-transparent hover:bg-slate-800 text-slate-200 font-bold py-3 px-6 rounded-md text-base border border-slate-700 transition-colors">
                    Contact Us
                </a>
            </div>
        </div>
      </main>
      <ReportFooter />
    </div>
  );
};

export default function SamplePage() {
  const [showReport, setShowReport] = useState(false);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    try {
      if (localStorage.getItem('kael_email')) {
        setShowReport(true);
      }
    } catch (e) {
      console.error('Could not access localStorage', e);
    } finally {
        setIsLoading(false);
    }
  }, []);

  const handleSuccess = () => {
    setShowReport(true);
  };
  
  if (isLoading) {
    return <div className="min-h-screen bg-slate-950" />;
  }

  return showReport ? <ReportPage /> : <EmailGate onSuccess={handleSuccess} />;
}
